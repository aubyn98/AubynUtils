"use strict";var P=(u,e,t)=>{if(!e.has(u))throw TypeError("Cannot "+t)};var m=(u,e,t)=>{if(e.has(u))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(u):e.set(u,t)};var r=(u,e,t)=>(P(u,e,"access private method"),t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});var v=typeof document<"u"?document.currentScript:null,s,h,l,f,c,g,p,E,w,b;class y{constructor(){m(this,s);m(this,l);m(this,c);m(this,p);m(this,w);var e;let{type:t,prefix:i="",expire:n=0,silent:o=!1,storageInstance:a}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!t&&!a)throw new Error("[Storage] type or storageInstance is required");if(this.storage=a||((e=window)===null||e===void 0?void 0:e[t]),!this.storage||typeof this.storage.setItem!="function")throw new Error(`[Storage] Invalid storage type: ${t||"undefined"}`);this.prefix=i,this.defaultExpire=Math.max(Number(n)||0,0),this.prefixStr=i?`${i}_`:"",this.silent=o}setItem(e,t){let{expire:i=0,renewal:n=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!r(this,l,f).call(this,e))throw new Error("key must be a string");const o=t==null||t===""?null:t,a=Number(i);if(isNaN(a)||a<0)throw new Error("Expire must be a non-negative number");const x=(a||this.defaultExpire)*1e3,I=r(this,c,g).call(this,{value:o,time:Date.now(),expire:x,renewal:n}),d=this.addPrefix(e);try{this.storage.setItem(d,I)}catch(S){if(S.name==="QuotaExceededError")r(this,s,h).call(this,"warn",`Storage full, cleaning expired data: ${e}`),r(this,w,b).call(this,d,I);else throw r(this,s,h).call(this,"error",`Set item failed: ${e}`,S),S}}getItem(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!r(this,l,f).call(this,e))return t;try{var i;const n=this.addPrefix(e),o=this.storage.getItem(n);if(o===null)return t;let a;try{a=JSON.parse(o)}catch(d){return r(this,s,h).call(this,"warn",`Parse item failed: ${e}`,d),this.removeItem(e),t}const x=Date.now();return a.expire>0&&x-a.time>a.expire?(this.removeItem(e),t):(a.expire>0&&a.renewal&&r(this,p,E).call(this,e,a.value,a.expire,a.renewal),(i=a.value)!==null&&i!==void 0?i:t)}catch(n){return r(this,s,h).call(this,"error",`Get item failed: ${e}`,n),t}}setItem_simple(e,t){if(!r(this,l,f).call(this,e))throw new Error("key must be a string");try{return this.storage.setItem(e,r(this,c,g).call(this,t))}catch(i){throw r(this,s,h).call(this,"error",`Set simple item failed: ${e}`,i),i}}getItem_simple(e,t){if(!r(this,l,f).call(this,e))return t;try{const i=this.storage.getItem(e);return i===null?t:JSON.parse(i)}catch(i){return r(this,s,h).call(this,"error",`Get simple item failed: ${e}`,i),t}}removeItem_simple(e){if(!r(this,l,f).call(this,e))throw new Error("key must be a string");try{this.storage.removeItem(e)}catch(t){throw r(this,s,h).call(this,"error",`Remove simple item failed: ${e}`,t),t}}removeItem(e){if(!r(this,l,f).call(this,e))throw new Error("key must be a string");try{this.storage.removeItem(this.addPrefix(e))}catch(t){throw r(this,s,h).call(this,"error",`Remove item failed: ${e}`,t),t}}addPrefix(e){return r(this,l,f).call(this,e)?this.prefixStr+e:e}removePrefix(e){return r(this,l,f).call(this,e)&&e.startsWith(this.prefixStr)?e.slice(this.prefixStr.length):e}clear(){try{this.storage.clear()}catch(e){throw r(this,s,h).call(this,"error","Clear storage failed",e),e}}getKeys(){try{return Array.from({length:this.storage.length},(e,t)=>this.storage.key(t)).filter(e=>r(this,l,f).call(this,e)&&e.startsWith(this.prefixStr)).map(e=>this.removePrefix(e))}catch(e){return r(this,s,h).call(this,"error","Get keys failed",e),[]}}removeItems(e){if(!Array.isArray(e))throw r(this,s,h).call(this,"error","Remove items failed: keys must be array"),new Error("[Storage] keys must be an array");e.forEach(t=>this.removeItem(t))}hasItem(e){if(!r(this,l,f).call(this,e))return!1;try{return this.storage.getItem(this.addPrefix(e))!==null}catch(t){return r(this,s,h).call(this,"error",`Check item exist failed: ${e}`,t),!1}}hasItem_simple(e){if(!r(this,l,f).call(this,e))return!1;try{return this.storage.getItem(e)!==null}catch(t){return r(this,s,h).call(this,"error",`Check simple item exist failed: ${e}`,t),!1}}}s=new WeakSet,h=function(e,t,i){this.silent||console[e](`[Storage] ${t}`,i||"")},l=new WeakSet,f=function(e){return typeof e!="string"?(r(this,s,h).call(this,"warn",`Invalid key type: ${typeof e} (expected string)`),!1):!0},c=new WeakSet,g=function(e){return JSON.stringify(e,(t,i)=>i===void 0?null:typeof i=="symbol"?i.toString():i)},p=new WeakSet,E=function(e,t,i,n){try{this.storage.setItem(this.addPrefix(e),r(this,c,g).call(this,{value:t,time:Date.now(),expire:i,renewal:n}))}catch(o){r(this,s,h).call(this,"error",`Renew item failed: ${e}`,o)}},w=new WeakSet,b=function(e,t){try{const i=[];Array.from({length:this.storage.length},(n,o)=>this.storage.key(o)).filter(n=>typeof n=="string").forEach(n=>{try{const o=JSON.parse(this.storage.getItem(n));(o==null?void 0:o.expire)>0&&Date.now()-o.time>o.expire&&i.push(n)}catch{}}),i.forEach(n=>this.storage.removeItem(n)),this.storage.setItem(e,t)}catch{throw new Error("[Storage] Storage full (even after cleaning expired data)")}};const N=(u=>typeof process<"u"&&process.env.NODE_ENV==="production"||typeof{url:typeof document>"u"?require("url").pathToFileURL(__filename).href:v&&v.tagName.toUpperCase()==="SCRIPT"&&v.src||new URL("storage/index.js",document.baseURI).href}<"u"&&((u={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1})===null||u===void 0?void 0:u.MODE)==="production")(),_=new y({type:"localStorage",silent:N}),R=new y({type:"sessionStorage",silent:N});exports.Storage=y;exports.local=_;exports.session=R;
